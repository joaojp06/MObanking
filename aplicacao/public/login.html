<!DOCTYPE html>
<html lang="ptbr">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Login - MoBanking</title>
	<link rel="stylesheet" href="https://unicons.iconscout.com/release/v2.1.9/css/unicons.css">
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<link rel="stylesheet" href="css/cadastro.css">
	<link rel="stylesheet" href="css/mensagemCard.css">
</head>

<body>
	<div class="voltar">
		<div class="seta">
			<a href="index.html"><span class="material-symbols-outlined">
					arrow_back
				</span></a>
		</div>
	</div>
	
	<div class="pai">
        <div class="box">
            <div class="form">
                <div class="logo">
                    <img src="imagens/V3 1.svg" alt="">
                </div>
                <div class="texto">
                    <div class="mensagem">
                        <span>Olá,</span>
                        <span><b>Seja Bem-Vindo!</b></span>
                    </div>
                </div>
                <div class="inputs">
                    <form>
                        <input type="text" id="email_input" placeholder="E-mail">
                        <input type="password" id="senhaLog_input" placeholder="Senha" >
                        <div class="box_esqueceu_senha">
                        <div class="esq_senha">
                            <a href="recuperar_senha.html">Esqueceu a senha?</a>
                        </div>
                    </div>
                    <button type="submit" onclick="entrar()" >Login</button>
                    </form>
                </div>
            </div>
            <div class="img">
                <img src="imagens/imagem_login.svg" alt="">
            </div>
        </div>
    </div>

	<div id="cardSucessoMsg" class="cardMensagem fecharCardMensagem">
		<svg class="wave" viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
			<path
				d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z"
				fill-opacity="1"></path>
		</svg>

		<div class="icon-container">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke-width="0" fill="currentColor"
				stroke="currentColor" class="icon">
				<path
					d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z">
				</path>
			</svg>
		</div>
		<div class="message-text-container">
			<p class="message-text" id="descCardSucesso">Mensagem de sucesso</p>
		</div>
		<svg onclick="fecharCardSucessoMensagem()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"
			stroke-width="0" fill="none" stroke="currentColor" class="cross-icon">
			<path fill="currentColor"
				d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z"
				clip-rule="evenodd" fill-rule="evenodd"></path>
		</svg>
	</div>

	<div id="cardErroMsg" class="cardMensagem fecharCardMensagem">
		<svg class="waveErro" viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
			<path
				d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z"
				fill-opacity="1"></path>
		</svg>

		<div class="icon-containerErro">
			<svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
          stroke-width="0"
          fill="currentColor"
          stroke="currentColor"
          class="iconErro"
        >
          <path
            d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM346.6 165.4c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0L256 222.1l-56.7-56.7c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9L222.1 256l-56.7 56.7c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0L256 289.9l56.7 56.7c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9L289.9 256l56.7-56.7z"
          ></path>
        </svg>
		</div>
		<div class="message-text-container">
			<p class="message-textErro" id="descCardErro">Mensagem de erro</p>
		</div>
		<svg onclick="fecharCardErroMensagem()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" stroke-width="0"
			fill="none" stroke="currentColor" class="cross-icon">
			<path fill="currentColor"
				d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z"
				clip-rule="evenodd" fill-rule="evenodd"></path>
		</svg>
	</div>

</body>

</html>
<script>
	function cadastrar() {

		var nomeVar = nomeBanco_input.value;
		var emailVar = emailCad_input.value;
		var senhaVar = senhaCad_input.value;
		var cnpjVar = cnpjCad_input;
		if (
			nomeVar == "" ||
			emailVar == "" ||
			senhaVar == "" ||
			cnpjVar == ""
		) {
			alert(`Insira todos os campos para prosseguir com o cadastro!`);
		} else {

		}

		// Enviando o valor da nova input
		fetch("/usuarios/cadastrar", {
			method: "POST",
			headers: {
				"Content-Type": "application/json",
			},
			body: JSON.stringify({
				// crie um atributo que recebe o valor recuperado aqui
				// Agora vá para o arquivo routes/usuario.js
				nomeServer: nomeVar,
				emailServer: emailVar,
				senhaServer: senhaVar,
				cnpjServer: cnpjVar
			}),
		})
			.then(function (resposta) {
				console.log("resposta: ", resposta);

				if (resposta.ok) {
					alert(`Cadastro realizado com sucesso! Redirecionando para tela de Login...`);

					setTimeout(() => {
						window.location = "cadastro.html";
					}, "2000");
				} else {
					alert(`Houve um erro ao tentar realizar o cadastro!`);
				}
			})
			.catch(function (resposta) {
				console.log(`#ERRO: ${resposta}`);
			});

		return false;
	}

	let emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;


	function entrar() {
		event.preventDefault();

		var emailVar = email_input.value;
		var senhaVar = senhaLog_input.value;

		if (emailVar == "" || senhaVar == "") {
			descCardErro.innerHTML = "Preencha todos os campos."
			usoCardMensagemErro()
			return false;
		}

		if (!emailRegex.test(emailVar)) {
			descCardErro.innerHTML = "Insira um e-mail válido."
			usoCardMensagemErro()

			return
		}

		console.log("FORM LOGIN: ", emailVar);
		console.log("FORM SENHA: ", senhaVar);

		fetch("/usuarios/autenticar", {
			method: "POST",
			headers: {
				"Content-Type": "application/json"
			},
			body: JSON.stringify({
				emailServer: emailVar,
				senhaServer: senhaVar
			})
		}).then(function (resposta) {
			console.log("ESTOU NO THEN DO entrar()!")

			if (resposta.ok) {
				console.log(resposta);

				resposta.json().then(json => {
					console.log(json);
					console.log(JSON.stringify(json));
					sessionStorage.EMAIL_USUARIO = json[0].emailUsuario;
					sessionStorage.NOME_USUARIO = json[0].nomeUsuario;
					sessionStorage.ID_USUARIO = json[0].idUsuario;
					sessionStorage.ID_EMPRESA = json[0].idEmpresa;
					sessionStorage.ID_TIPO_USUARIO = json[0].idTipoUsuario;
					sessionStorage.ID_PLANO = json[0].fkPlano;
					sessionStorage.CPF_USUARIO = json[0].cpfUsuario;

					usoCardMensagemSucesso()
					descCardSucesso.innerHTML = `Login realizado com sucesso!`

					if (sessionStorage.ID_TIPO_USUARIO == 4) {
						setTimeout(function () {
							window.location = "./dashboard/devIndex.html";
						}, 1500); // apenas para exibir o loading
					} else {
						setTimeout(function () {
							window.location = "./dashboard/card.html";
						}, 1500); // apenas para exibir o loading
					}
				});

			} else {

				console.log("Houve um erro ao tentar realizar o login!");
				descCardErro.innerHTML = "E-mail ou senha inválidos!"
				usoCardMensagemErro()
				resposta.text().then(texto => {
					console.error(texto);
				});
			}

		}).catch(function (erro) {
			console.log(erro);
		})

		return false;
	}


	// Funções de card de alerta

	// esse é o id = descCardSucesso para innerHTML a mensagem de sucesso
	function abrirCardSucesoMensagem() {

		const card = document.getElementById("cardSucessoMsg");
		card.classList.remove("fecharCardMensagem");
		card.classList.add("abriCardMensagem");
	}
	function fecharCardSucessoMensagem() {
		const card = document.getElementById("cardSucessoMsg");
		card.classList.remove("abriCardMensagem");
		card.classList.add("fecharCardMensagem");
	}
	// esse é o id = descCardErro para innerHTML a mensagem de sucesso
	function fecharCardErroMensagem() {
		const card = document.getElementById("cardErroMsg");
		card.classList.remove("abriCardMensagem");
		card.classList.add("fecharCardMensagem");
	}
	function abrirCardErroMensagem() {
		const card = document.getElementById("cardErroMsg");
		card.classList.remove("fecharCardMensagem");
		card.classList.add("abriCardMensagem");
	}
	function usoCardMensagemErro() {
		abrirCardErroMensagem();
		setTimeout(() => {
			fecharCardErroMensagem();
		}, "7000");
	}
	function usoCardMensagemSucesso() {
		abrirCardSucesoMensagem();
		setTimeout(() => {
			fecharCardSucessoMensagem();
		}, "7000");
	}

</script>