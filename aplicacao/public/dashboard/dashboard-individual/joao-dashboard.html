<!DOCTYPE html>
<html lang="ptbr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MOBANKING</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="shortcut icon" href="../../imagens/logo.ico" type="image/x-icon" />
  <link rel="stylesheet" href="../../css/reset.css" />
  <link rel="stylesheet" href="../../css/mensagemCard.css">
  <link rel="stylesheet" href="../../css/card.css" />
  <link rel="stylesheet" href="../../css/default.css" />
  <link rel="stylesheet" href="../../css/cardConfirmacao.css">
  <link rel="stylesheet" href="../../css/estilizacao-individual/joao.css">
  <!-- scripts do Chart.js - 2022-1 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body onload="listarPrevisoes() ,atualizarKpi()">
  <div id="frame" class="frame-aplicacao" style="display: flex">
    <nav class="menu-lateral" onmouseenter="exibirMenu()" onmouseleave="ocultarMenu()">
      <img src="../../imagens/mobank-logo-menu-lateral.svg" alt="Logo" class="logo-menu">

      <ul id="menuLateralBox">

        <li class="dashboard-item">
          <a href="javascript:void(0);" onclick="toggleSubmenuServidores()">
            <span class="icon-menu"><i class="fa-solid fa-server"></i></span>
            <span class="titulo-link-menu">Servidores </span> <i class="fa-solid setaMenuServidores fa-sort-down"></i>
          </a>
        </li>

        <div class="submenuServidores" onmouseenter="manterSubmenu()" onmouseleave="fecharSubmenu()">
          <li><a href="../card.html">Máquinas</a></li>
          <li><a href="../dashboard-individual/maikon-dashboard.html">Status hardware</a></li>
          <li><a href="../dashboard-individual/joao-dashboard.html">Previsão de Alertas</a></li>
        </div>

        <li>
          <a href="../dashboard.html">
            <span class="icon-menu"><i class="fa-solid fa-chart-simple"></i></span>
            <span class="titulo-link-menu">Gráficos</span>
          </a>
        </li>
        <li>
          <a href="../alertas.html">
            <span class="icon-menu"><i class="fa-solid fa-triangle-exclamation"></i></span>
            <span class="titulo-link-menu">Alertas</span>
          </a>
        </li>
        <li class="dashboard-item">
          <a href="javascript:void(0);" onclick="toggleSubmenu()">
            <span class="icon-menu"><i class="fa-solid fa-chart-pie"></i></span>
            <span class="titulo-link-menu">Dashboard </span> <i class="fa-solid setaMenu fa-sort-down"></i>
          </a>
        </li>
        <div class="submenu" onmouseenter="manterSubmenu()" onmouseleave="fecharSubmenu()">
          <li><a href="../dashboard-individual/maikon-dashboard.html">Maikon</a></li>
          <li><a href="../dashboard-individual/joao-dashboard.html">JP</a></li>
          <li><a href="../dashboard-individual/fabio-dashboard.html">Fabio</a></li>
          <li><a href="../dashboard-individual/kaua-dashboard.html">Kauâ</a></li>
          <li><a href="../dashboard-individual/faria-dashboard.html">Gabriel</a></li>
        </div>
      </ul>

      <div class="name-menu">
        <a href="../usuarioInfo.html">
          <h2 id="nome_perfil_menu"></h2>
        </a>
      </div>

      <a class="buttonSair-menu" href="../../index.html">
        <h2>Sair</h2>
      </a>
    </nav>

    <!-- CONTEÚDO -->
    <div class="conteudo">
      <div class="titulo" style="display: flex;">
        <h1>Previsão de Alertas de RAM </h1>
        <div class="info"><img onclick="" src="../../imagens/jp-individual-icone-info.svg" alt=""></div>

      </div>
      <div class="container-kpis">
        <div class="kpi-verde">
          <div><img src="../../imagens/Alert triangle-verde.svg"></div>
          <div class="qtd-alerta"><b id="qtdAlertaVerde"></b></div>
        </div>

        <div class="kpi-amarelo">
          <div><img src="../../imagens/Alert triangle-amarelo.svg"></div>
          <div class="qtd-alerta"><b id="qtdAlertaAmarelo"></b></div>
        </div>

        <div class="kpi-vermelho">
          <div><img src="../../imagens/Alert triangle-vermelho.svg"></div>
          <div class="qtd-alerta"><b id="qtdAlertaVermelho"></b></div>
        </div>

      </div>

      <div id="listagemServidores" class="card-grid-pai">

      </div>
    </div>
  </div>

  <!-- MODAL -->

  <div style="display: none" class="modal" id="modal">
    <i onclick="fecharModal()" id="closeModal" class="fa-solid fa-x"></i>

    <div id="modalGraficos">
      <!-- Essa parte recebe de forma dinâmica(fkPlano) os gráficos que são exibidos em tempo real -->
    </div>

    <div class="div-inp">
      <h1> Informações do Servidor </h1>
      <br>
      <label>
        <b>Apelido: </b><input id="input_apelido" type="text">
      </label>
      <label>
        <b>Função: </b><input id="input_funcao" type="text">
      </label>
      <button onclick="editarInfoServidor(idServidorPar)">Editar</button>
    </div>

    <h1>Limites dos componentes</h1>
    <div class="mudarLimiteBox">
      <div class="boxInputs" id="mudarLimiteBox">

      </div>
      <button onclick="editarLimiteServidor(idServidorPar)">Editar</button>
    </div>

    <button class="desativarServidorButton" id="buttonDesativarServidor" onclick="confirmarDesativar()">Desativar
      servidor</button>
    <button class="desativarServidorButton" id="buttonAtivarServidor" onclick="confirmarAtivar()">Ativar
      servidor</button>
  </div>





  <!-- CARD DE SUCESSO -->

  <div id="cardSucessoMsg" class="cardMensagem fecharCardMensagem">
    <svg class="wave" viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z"
        fill-opacity="1"></path>
    </svg>

    <div class="icon-container">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke-width="0" fill="currentColor"
        stroke="currentColor" class="icon">
        <path
          d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z">
        </path>
      </svg>
    </div>
    <div class="message-text-container">
      <p class="message-text">Mensagem de sucesso</p>
      <p class="sub-text" id="descCardSucesso"></p>
    </div>
    <svg onclick="fecharCardSucessoMensagem()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" stroke-width="0"
      fill="none" stroke="currentColor" class="cross-icon">
      <path fill="currentColor"
        d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z"
        clip-rule="evenodd" fill-rule="evenodd"></path>
    </svg>
  </div>

  <!-- CARD DE ERRO -->
  <div id="cardErroMsg" class="cardMensagem fecharCardMensagem">
    <svg class="waveErro" viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z"
        fill-opacity="1"></path>
    </svg>

    <div class="icon-containerErro">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke-width="0" fill="currentColor"
        stroke="currentColor" class="iconErro">
        <path
          d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z">
        </path>
      </svg>
    </div>
    <div class="message-text-container">
      <p class="message-textErro">Mensagem de erro</p>
      <p class="sub-text" id="descCardErro"></p>
    </div>
    <svg onclick="fecharCardErroMensagem()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" stroke-width="0"
      fill="none" stroke="currentColor" class="cross-icon">
      <path fill="currentColor"
        d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z"
        clip-rule="evenodd" fill-rule="evenodd"></path>
    </svg>
  </div>

  <div class="alertCardEstatico" id="alertCardEstatico">
    <span class="tituloAlerta">Alerta</span>
    <span class="descAlerta">A máquina com ID: 1 atingiu o limite estipulado de 85% no serviço de CPU</span>
    <span>Data: 14/10/2024 - 12:22:09</span>
  </div>


  <div class="confirmarModal" id="confirmarModalDesativar">
    <h2>Deseja realmente desativar esse servidor ?</h2>
    <div>
      <button onclick="fecharDesativar(), desativarServidor()" class="simButon">Sim</button>
      <button onclick="fecharDesativar()" class="naoButon">Não</button>
    </div>
  </div>

  <div class="confirmarModal" id="confirmarModalAtivar">
    <h2>Deseja ativar esse servidor ?</h2>
    <div>
      <button onclick="fecharAtivar(), ativarServidor()" class="simButon">Sim</button>
      <button onclick="fecharAtivar()" class="naoButon">Não</button>
    </div>
  </div>


</body>

</html>

<script>

  function toggleSubmenu() {
    const submenu = document.querySelector('.submenu');
    const seta = document.querySelector('.setaMenu');

    submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
    submenuAberto = submenu.style.display === 'block';

    if (submenuAberto) {
      seta.classList.add("girarSeta");
    } else {
      seta.classList.remove("girarSeta");
    }
  }

  function toggleSubmenuServidores() {
    const submenu = document.querySelector('.submenuServidores');
    const setaServidores = document.querySelector('.setaMenuServidores');

    submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
    submenuAberto = submenu.style.display === 'block';

    if (submenuAberto) {
      setaServidores.classList.add("girarSetaServidores");
    } else {
      setaServidores.classList.remove("girarSetaServidores");
    }
  }

  function exibirMenu() {
    const menuLateral = document.querySelector('.menu-lateral');
    menuLateral.classList.add('menu-aberto');
  }

  function ocultarMenu() {
    const submenu = document.querySelector('.submenu');
    const submenuServidores = document.querySelector('.submenuServidores');
    const seta = document.querySelector('.setaMenu');
    const setaServidores = document.querySelector('.setaMenuServidores');

    // Fecha o submenu e redefine o ícone de seta quando o mouse sai do nav
    submenu.style.display = 'none';
    submenuServidores.style.display = 'none';
    seta.classList.remove("girarSeta");
    setaServidores.classList.remove("girarSetaServidores");
    submenuAberto = false;
    submenuServidoresAberto = false;
  }

  function confirmarDesativar() {

    confirmarModalDesativar.style.top = '0'
    const frame = document.getElementById('frame');
    frame.classList.add('blur-grid')

  }

  function fecharDesativar() {

    const frame = document.getElementById('frame');
    frame.classList.remove('blur-grid')
    confirmarModalDesativar.style.top = '-20%'
  }

  function confirmarAtivar() {

    confirmarModalAtivar.style.top = '0'
    const frame = document.getElementById('frame');
    frame.classList.add('blur-grid')

  }

  function fecharAtivar() {

    const frame = document.getElementById('frame');
    frame.classList.remove('blur-grid')
    confirmarModalAtivar.style.top = '-20%'
  }



  const menuLaterealHTML = document.getElementById('menuLateralBox')
  var sessTipoUsuario = sessionStorage.ID_TIPO_USUARIO
  if (sessTipoUsuario == 1) {
    menuLaterealHTML.innerHTML += `
     <li>
          <a href="funcionarios.html">
            <span class="icon-menu"><i class="fa-solid fa-user"></i></span>
            <span class="titulo-link-menu">Funcionários</span>
          </a>
        </li>
    `
  }


  if (sessionStorage.ID_PLANO == 1) {
    modalGraficos.innerHTML = `
    
    <div class="grafico-box">
    <h2>Uso CPU </h2>
    <canvas id="graficoCPU-box"></canvas>
  </div>
  <div class="grafico-box">
    <h2>Uso RAM </h2>
    <canvas id="graficoRAM-box"></canvas>
  </div>
  
  `

    mudarLimiteBox.innerHTML += `
  <label for="">
        CPU %
        <input id="cpu_limite_input" type="number">
      </label>
      <label for="">
        RAM %
        <input id="ram_limite_input" type="number">
      </label>
      
  `
  } else if (sessionStorage.ID_PLANO == 2) {
    modalGraficos.innerHTML += `
    <div class="grafico-box">
    <h2>Uso CPU </h2>
    <canvas id="graficoCPU-box"></canvas>
  </div>
  <div class="grafico-box">
    <h2>Uso RAM </h2>
    <canvas id="graficoRAM-box"></canvas>
  </div>
  <div class="grafico-box" id="receberGraficoDados">
    <h2>Uso DISCO </h2>
    <canvas id="graficoDISCO-box"></canvas>
  </div>
  
  
  `
    mudarLimiteBox.innerHTML += `
    <label for="">
        CPU %
        <input id="cpu_limite_input" type="number">
      </label>
      <label for="">
        RAM %
        <input id="ram_limite_input" type="number">
      </label>
      <label for="">
        DISCO GB
        <input id="disco_limite_input" type="number">
      </label>
  `
  } else if (sessionStorage.ID_PLANO == 3) {
    modalGraficos.innerHTML += `
    
    <div class="grafico-box">
      <h2>Uso CPU </h2>
      <canvas id="graficoCPU-box"></canvas>
    </div>
    <div class="grafico-box">
      <h2>Uso RAM </h2>
      <canvas id="graficoRAM-box"></canvas>
    </div>
    <div class="grafico-box" id="receberGraficoDados">
      <h2>Uso DISCO </h2>
      <canvas id="graficoDISCO-box"></canvas>
    </div>
    <div class="grafico-box" id="receberGraficoDados">
      <h2>Mb REDE </h2>
      <canvas id="graficoREDE-box"></canvas>
    </div>
    
    
    `

    mudarLimiteBox.innerHTML += `
      <label for="">
        CPU %
        <input id="cpu_limite_input" type="number">
      </label>
      <label for="">
        RAM %
        <input id="ram_limite_input" type="number">
      </label>
      <label for="">
        DISCO GB
        <input id="disco_limite_input" type="number">
      </label>
      <label for="">
        REDE MB
        <input id="rede_limite_input" type="number">
      </label>
    `
  }

  nome_perfil_menu.innerHTML = sessionStorage.NOME_USUARIO

  let idServidorPar;



  function fecharModal() {
    modal.style.display = "none";
    const frame = document.getElementById("frame");
    frame.classList.remove("blur-grid");
    listarServidores()
  }

  var idEmpresa = sessionStorage.ID_EMPRESA;

  function listarVerde() {
    if (status == 'ativo') {
      status = 1 // VERÁ SERVIDORES ATIVOS - MODIFICAÇÃO NA CONTROLLE
    } else {
      status = 2
    }
    fetch(`/joao/listarVerde/${idEmpresa}/${status}`, {
      method: "GET",
    })
      .then(function (resposta) {
        if (resposta.status == 204) {

          listagemServidores.innerHTML = "Nenhum resultado encontrado."

          throw "Nenhum resultado encontrado!!";
        } else if (resposta.status == 500) {
          alert("Deu ruim")
        }
        resposta.json().then((servidores) => {
          console.log(servidores); // Log da resposta da API com os dados do banco
          planoEmpresa = sessionStorage.ID_PLANO

          console.log(`Estou no HTML PLANO EMPRESA ${planoEmpresa}`)

          servidores.forEach((registro) => {

            var qtdAlerta = registro.quantidade

            qtdAlertaVerde.innerHTML = `${qtdAlerta}`;

          });

        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function listarAmarelo(params) {
    if (status == 'ativo') {
      status = 1 // VERÁ SERVIDORES ATIVOS - MODIFICAÇÃO NA CONTROLLE
    } else {
      status = 2
    }
    fetch(`/joao/listarVerde/${idEmpresa}/${status}`, {
      method: "GET",
    })
      .then(function (resposta) {
        if (resposta.status == 204) {

          listagemServidores.innerHTML = "Nenhum resultado encontrado."

          throw "Nenhum resultado encontrado!!";
        } else if (resposta.status == 500) {
          alert("Deu ruim")
        }
        resposta.json().then((servidores) => {
          console.log(servidores); // Log da resposta da API com os dados do banco
          planoEmpresa = sessionStorage.ID_PLANO

          console.log(`Estou no HTML PLANO EMPRESA ${planoEmpresa}`)

          servidores.forEach((registro) => {

            var qtdAlerta = registro.quantidade

            qtdAlertaVerde.innerHTML = `${qtdAlerta}`;

          });

        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function listarAmarelo(params) {
    if (status == 'ativo') {
      status = 1 // VERÁ SERVIDORES ATIVOS - MODIFICAÇÃO NA CONTROLLE
    } else {
      status = 2
    }
    fetch(`/joao/listarAmarelo/${idEmpresa}/${status}`, {
      method: "GET",
    })
      .then(function (resposta) {
        if (resposta.status == 204) {

          listagemServidores.innerHTML = "Nenhum resultado encontrado."

          throw "Nenhum resultado encontrado!!";
        } else if (resposta.status == 500) {
          alert("Deu ruim")
        }
        resposta.json().then((servidores) => {
          console.log(servidores); // Log da resposta da API com os dados do banco
          planoEmpresa = sessionStorage.ID_PLANO

          console.log(`Estou no HTML PLANO EMPRESA ${planoEmpresa}`)

          servidores.forEach((registro) => {

            var qtdAlerta = registro.quantidade

            qtdAlertaAmarelo.innerHTML = `${qtdAlerta}`;

          });

        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function listarVermelho(params) {
    if (status == 'ativo') {
      status = 1 // VERÁ SERVIDORES ATIVOS - MODIFICAÇÃO NA CONTROLLE
    } else {
      status = 2
    }
    fetch(`/joao/listarVermelho/${idEmpresa}/${status}`, {
      method: "GET",
    })
      .then(function (resposta) {
        if (resposta.status == 204) {

          listagemServidores.innerHTML = "Nenhum resultado encontrado."

          throw "Nenhum resultado encontrado!!";
        } else if (resposta.status == 500) {
          alert("Deu ruim")
        }
        resposta.json().then((servidores) => {
          console.log(servidores); // Log da resposta da API com os dados do banco
          planoEmpresa = sessionStorage.ID_PLANO

          console.log(`Estou no HTML PLANO EMPRESA ${planoEmpresa}`)

          servidores.forEach((registro) => {

            var qtdAlerta = registro.quantidade
            qtdAlertaVermelho.innerHTML = `${qtdAlerta}`;

          });

        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }


  function atualizarKpi() {
    listarVerde()
    listarAmarelo()
    listarVermelho()
  }

  setInterval(atualizarKpi, 5000);


  function listarServidores() {

    listagemServidores.innerHTML = `` //Limpando a div para atualizar com maior fluidez
    var status = selectListServidores.value
    if (status == 'ativo') {
      status = 1 // VERÁ SERVIDORES ATIVOS - MODIFICAÇÃO NA CONTROLLE
    } else {
      status = 2
    }

    fetch(`/aquarios/listarServidores/${idEmpresa}/${status}`, {
      method: "GET",
    })
      .then(function (resposta) {
        if (resposta.status == 204) {

          listagemServidores.innerHTML = "Nenhum resultado encontrado."

          throw "Nenhum resultado encontrado!!";
        }
        resposta.json().then((servidores) => {
          console.log(servidores); // Log da resposta da API com os dados do banco
          planoEmpresa = sessionStorage.ID_PLANO

          console.log(`Estou no HTML PLANO EMPRESA ${planoEmpresa}`)


          servidores.forEach((registro) => {

            listagemServidores.innerHTML +=
              `
          <div class="card">
            <h2 id="apelido_card">${registro.apelido}</h2>
            <h2 id="funcao_card">${registro.funcao}</h2>
            <div class="back-image-card"></div>
            <div class="div-msg-alerta"><b>Aqui vai ter um texto dinâmico com as informações do alerta, variando de acordo com a cor</b>
            </div>
            <div class="div-alerta"> 
              <div class="simbolo-alerta"><img src="../../imagens/Alert triangle.svg"></div>
              <div class="cor-alerta"></div>
            </div>
        
          </div>`;
          });

        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  // Função que atualiza a listagem de previsões
  function listarPrevisoes() {
    const container = listagemServidores; // Referência ao container onde os servidores serão listados
    const servidoresExistentes = container.querySelectorAll(".card"); // Seleciona os cards já existentes

    if (status == 'ativo') {
      status = 1; // SERVIDORES ATIVOS
    } else {
      status = 2;
    }

    fetch(`/joao/listarPrevisoes/${idEmpresa}/${status}`, {
      method: "GET",
    })
      .then(function (resposta) {
        if (resposta.status == 204) {
          container.innerHTML = "Nenhum resultado encontrado.";
          throw "Nenhum resultado encontrado!!";
        }

        resposta.json().then((servidores) => {
          console.log(servidores); // Log da resposta da API com os dados do banco

          // Itera sobre cada servidor para atualizar ou adicionar os dados
          servidores.forEach((registro) => {
            let cardExistente = false;
            let cardParaAtualizar;

            // Verifica se o card do servidor já existe
            servidoresExistentes.forEach((card) => {
              const apelidoCard = card.querySelector("#apelido_card").innerText;
              if (apelidoCard === registro.apelido) {
                cardExistente = true;
                cardParaAtualizar = card; // Armazena o card a ser atualizado
              }
            });

            if (cardExistente) {
              // Atualiza o card existente com os novos valores
              cardParaAtualizar.querySelector("#funcao_card").innerText = registro.funcao;
              cardParaAtualizar.querySelector(".processos p").innerText = registro.valor;
              cardParaAtualizar.querySelector(".div-msg-alerta b").innerHTML = getTextoAlerta(registro.fkAlertaPrevisao, registro.limite_valor);
              cardParaAtualizar.querySelector(".cor-alerta").style.backgroundColor = getCorAlerta(registro.fkAlertaPrevisao);
            } else {
              // Adiciona um novo card para o servidor se não existir
              container.innerHTML += `
                        <div class="card">
                            <h2 id="apelido_card">${registro.apelido}</h2>
                            <h2 id="funcao_card">${registro.funcao}</h2>
                            <div class="div-msg-alerta"><b>${getTextoAlerta(registro.fkAlertaPrevisao, registro.limite_valor)}</b></div>
                            <div class="container">
                                <div class="processos">
                                    <p>${registro.valor}</p>
                                    <b>Processos</b>
                                </div>
                                <div class="div-alerta">
                                    <div class="simbolo-alerta"><img src="../../imagens/Alert triangle.svg"></div>
                                    <div class="cor-alerta" style="background-color: ${getCorAlerta(registro.fkAlertaPrevisao, registro.limite_valor)};"></div>
                                </div>
                            </div>
                        </div>`;
            }
          });
        });
      })
      .catch(function (erro) {
        console.log(`#ERRO: ${erro}`);
      });
  }

  // Função para obter o texto do alerta baseado no código
  function getTextoAlerta(corAlerta, limite) {
    console.log(`Esse é o limite ${limite}`)
    switch (corAlerta) {
      case 1:
        return "Bom desempenho! A operação está com uma quantidade de processos dentro da capacidade ideal.";
      case 2:
        return `Processos próximos ao limite, é hora de verificar a carga para que a RAM não atinja o limite de ${limite}. Evite executar novos processos.`;
      case 3:
        return `<span style="color: red;">Atenção máxima!</span> O limite de processos está prestes a ser atingido e a RAM corre um grande risco de atingir o limite de ${limite}%.`;
      default:
        return "";
    }
  }

  // Função para obter a cor de alerta baseada no código
  function getCorAlerta(corAlerta) {
    switch (corAlerta) {
      case 1:
        return 'green';
      case 2:
        return 'yellow';
      case 3:
        return 'red';
      default:
        return 'gray';
    }
  }

  // Inicia a execução da função listarPrevisoes a cada 5 segundos
  setInterval(listarPrevisoes, 5000);




  function desativarServidor() {
    var idServidor = idServidorPar
    console.log(`Estou na minha função desativarServidor e o idServidor é: ${idServidor}`)


    if (idServidor == null) {
      alert("Algo deu errado")
    } else {
      fetch(`/aquarios/desativarServidor/${idServidor}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({

        }),
      }).then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {

          usoCardMensagemSucesso()
          descCardSucesso.innerHTML = `Servidor id:${idServidor} desativado` //Descrição para o card

          setTimeout(() => {
            fecharModal();
          }, "1000");

        } else {
          console.log(resposta);
          throw "Houve um erro ao tentar realizar a desativação!";
        }
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        return false;
      });
    }

  }

  function ativarServidor() {


    var idServidor = idServidorPar
    console.log(`Estou na minha função ativarServidor e o idServidor é: ${idServidor}`)


    if (idServidor == null) {
      alert("Algo deu errado")
    } else {
      fetch(`/aquarios/ativarServidor/${idServidor}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({

        }),
      }).then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {

          usoCardMensagemSucesso()
          descCardSucesso.innerHTML = `Servidor id:${idServidor} ativado` //Descrição para o card

          setTimeout(() => {
            fecharModal();
          }, "1000");

        } else {
          console.log(resposta);
          throw "Houve um erro ao tentar realizar a ativação!";
        }
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        return false;
      });
    }

  }

  function editarInfoServidor(idServidorPar) {

    var idServidor = idServidorPar

    var apelidoServidor = input_apelido.value
    var funcaoServidor = input_funcao.value

    fetch(`/aquarios/editarInfoServidor`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

        idServidorServer: idServidor,
        apelidoServidorServer: apelidoServidor,
        funcaoServidorServer: funcaoServidor

      }),
    }).then(function (resposta) {
      console.log("resposta: ", resposta);

      if (resposta.ok) {

        usoCardMensagemSucesso()
        descCardSucesso.innerHTML = `Edição de informações realizada`

        setTimeout(() => {
          fecharModal();
        }, "1000");


      } else {
        console.log(resposta);
        throw "Houve um erro ao tentar realizar a edição!";
      }
    }).catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
      return false;
    });

  }


  function editarLimiteServidor(idServidorPar) {

    var idServidor = idServidorPar
    var idPlano = sessionStorage.ID_PLANO

    if (idPlano == 1) {
      var limiteCpu = cpu_limite_input.value
      var limiteRam = ram_limite_input.value
    } else if (idPlano == 2) {
      var limiteCpu = cpu_limite_input.value
      var limiteRam = ram_limite_input.value
      var limiteDisco = disco_limite_input.value
    } else if (idPlano == 3) {
      var limiteCpu = cpu_limite_input.value
      var limiteRam = ram_limite_input.value
      var limiteDisco = disco_limite_input.value
      var limiteRede = rede_limite_input.value
    }

    fetch(`/aquarios/editarLimiteServidor`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

        idServidorServer: idServidor,
        idPlanoServer: idPlano,
        limiteCpuServer: limiteCpu,
        limiteRamServer: limiteRam,
        limiteDiscoServer: limiteDisco,
        limiteRedeServer: limiteRede

      }),
    }).then(function (resposta) {
      console.log("resposta: ", resposta);

      if (resposta.ok) {

        usoCardMensagemSucesso()
        descCardSucesso.innerHTML = `Edição de limite realizada`

        setTimeout(() => {
          fecharModal();
        }, "1000");


      } else {
        console.log(resposta);
        throw "Houve um erro ao tentar realizar a edição!";
      }
    }).catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
      return false;
    });

  }

  function listarLimite(id_servidor) {
    fetch(`/aquarios/listarLimite/${id_servidor}`, {
      method: "GET",
    })
      .then(function (resposta) {

        resposta.json().then((limite) => {
          limite.forEach((registro) => {

            cpu_limite_input.value = registro.limite_valor_cpu
            ram_limite_input.value = registro.limite_valor_ram

            disco_limite_input.value = registro.limite_valor_disco
            rede_limite_input.value = registro.limite_valor_rede

          });
        });

      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function listarApelidoFuncaoInp(id_servidor) {
    fetch(`/aquarios/listarApelidoFuncaoInput/${id_servidor}`, {
      method: "GET",
    })
      .then(function (resposta) {

        resposta.json().then((ApelidoFuncao) => {
          ApelidoFuncao.forEach((registro) => {

            input_apelido.value = registro.apelido;
            input_funcao.value = registro.funcao

          });
        });

      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function obterDadosGrafico(idServidorParFun) {

    var idServidor = idServidorParFun

    fetch(`/medidas/servidor/${idServidor}`, { cache: 'no-store' }).then(function (response) {
      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          resposta.reverse();

          plotarGrafico(resposta);

        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API');

      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
      });
  }

  function AtualizarGraficos(idServidor) {
    obterDadosGrafico(idServidor);
    iniciarAtualizacaoAoVivo();
  }

  function iniciarAtualizacaoAoVivo() {
    setInterval(() => {
      if (idServidorPar) { // Certifique-se de que o parâmetro está definido
        obterDadosGrafico(idServidorPar); // Atualize o gráfico com o parâmetro atual
      }
    }, 5000); // Intervalo de 3 segundos
  }


  let graficoCpuInstance = null;
  let graficoRamInstance = null;
  let graficoDiscoInstance = null;
  let graficoRedeInstance = null;

  function plotarGrafico(resposta) {


    console.log('iniciando plotagem do gráfico...');

    if (graficoCpuInstance) {
      graficoCpuInstance.destroy();
    }
    if (graficoRamInstance) {
      graficoRamInstance.destroy();
    }
    if (graficoDiscoInstance) {
      graficoDiscoInstance.destroy();
    }
    if (graficoRedeInstance) {
      graficoRedeInstance.destroy();
    }

    // Criando estrutura para plotar gráfico - labels
    let labelsCpu = [];
    let labelsRam = [];
    let labelsDisco = [];
    let labelsRede = [];

    // Criando estrutura para plotar gráfico - dados
    let dadosCpu = {
      labels: labelsCpu,
      datasets: [{
        label: '',
        data: [],
      }],

    };

    let dadosRam = {
      labels: labelsRam,
      datasets: [{
        label: '',
        data: [],
      }],

    };

    let dadosDisco = {
      labels: labelsDisco,
      datasets: [{
        label: '',
        data: [],
      }],

    };

    let dadosRede = {
      labels: labelsRede,
      datasets: [{
        label: '',
        data: [],
      }],

    };

    console.log('----------------------------------------------')
    console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
    console.log(resposta)

    // Inserindo valores recebidos em estrutura para plotar o gráfico
    for (i = 0; i < resposta.length; i++) {
      var registro = resposta[i];

      let data = registro.data;
      let horario = new Date(data).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

      if (registro.fkServico == 1) {
        labelsCpu.push(`${horario}`);
        dadosCpu.datasets[0].data.push(registro.valor);
      }

      if (registro.fkServico == 2) {
        labelsRam.push(`${horario}`);
        dadosRam.datasets[0].data.push(registro.valor);
      }

      if (registro.fkServico == 3) {
        labelsDisco.push(`${horario}`);
        dadosDisco.datasets[0].data.push(registro.valor);
      }

      if (registro.fkServico == 4) {
        labelsRede.push(`${horario}`);
        dadosRede.datasets[0].data.push(registro.valor);
      }

    }

    console.log('----------------------------------------------')
    console.log('O gráfico será plotado com os respectivos valores:')
    console.log('Labels:')
    console.log('dadosCpu:')
    console.log(dadosCpu.datasets)
    console.log('dadosRam:')
    console.log(dadosRam.datasets)
    console.log('dadosDisco:')
    console.log(dadosDisco.datasets)
    console.log('dadosRede:')
    console.log(dadosRede.datasets)
    console.log('----------------------------------------------')


    const graficoCPU = document.getElementById('graficoCPU-box');
    const graficoRAM = document.getElementById('graficoRAM-box');
    const graficoDISCO = document.getElementById('graficoDISCO-box');
    const graficoREDE = document.getElementById('graficoREDE-box');

    graficoCpuInstance = new Chart(graficoCPU, {
      type: 'line',
      data: {
        labels: dadosCpu.labels,
        datasets: [{
          label: dadosCpu.datasets[0].label,
          data: dadosCpu.datasets[0].data,
          borderColor: 'white',
          backgroundColor: 'rgba(255, 255, 255, 0.5)',
          fill: true,
          pointBackgroundColor: 'white',
          pointBorderColor: 'white',
          pointRadius: 5,
          tension: 0.1
        }]
      },
      options: {
        scales: {
          x: {
            grid: {
              display: false // Remove a grade vertical
            },
            ticks: {
              color: 'white', // Cor dos rótulos do eixo X
              font: {
                size: 16 // Tamanho da fonte das labels no eixo X
              }
            }
          },
          y: {
            grid: {
              display: false // Remove a grade horizontal
            },
            ticks: {
              color: 'white', // Cor dos rótulos do eixo Y
              font: {
                size: 16 // Tamanho da fonte das labels no eixo X
              }
            }
          }
        },
        plugins: {
          legend: {
            display: false // Remove a legenda
          }
        },
        elements: {
          line: {
            tension: 0.4 // Deixa as linhas mais suaves
          }
        }
      }
    });

    graficoRamInstance = new Chart(graficoRAM, {
      type: 'line',
      data: {
        labels: dadosRam.labels,
        datasets: [{
          label: dadosRam.datasets[0].label,
          data: dadosRam.datasets[0].data,
          borderColor: 'white',
          backgroundColor: 'rgba(255, 255, 255, 0.5)',
          fill: true,
          pointBackgroundColor: 'white',
          pointBorderColor: 'white',
          pointRadius: 5,
          tension: 0.1
        }]
      },
      options: {
        scales: {
          x: {
            grid: {
              display: false // Remove a grade vertical
            },
            ticks: {
              color: 'white', // Cor dos rótulos do eixo X
              font: {
                size: 16 // Tamanho da fonte das labels no eixo X
              }
            }
          },
          y: {
            grid: {
              display: false // Remove a grade horizontal
            },
            ticks: {
              color: 'white', // Cor dos rótulos do eixo Y
              font: {
                size: 16 // Tamanho da fonte das labels no eixo X
              }
            }
          }
        },
        plugins: {
          legend: {
            display: false // Remove a legenda
          }
        },
        elements: {
          line: {
            tension: 0.4 // Deixa as linhas mais suaves
          }
        }
      }
    });

    graficoDiscoInstance = new Chart(graficoDISCO, {
      type: 'line',
      data: {
        labels: dadosDisco.labels,
        datasets: [{
          label: dadosDisco.datasets[0].label,
          data: dadosDisco.datasets[0].data,
          borderColor: 'white',
          backgroundColor: 'rgba(255, 255, 255, 0.5)',
          fill: true,
          pointBackgroundColor: 'white',
          pointBorderColor: 'white',
          pointRadius: 5,
          tension: 0.1
        }]
      },
      options: {
        scales: {
          x: {
            grid: {
              display: false // Remove a grade vertical
            },
            ticks: {
              color: 'white', // Cor dos rótulos do eixo X
              font: {
                size: 16 // Tamanho da fonte das labels no eixo X
              }
            }
          },
          y: {
            grid: {
              display: false // Remove a grade horizontal
            },
            ticks: {
              color: 'white', // Cor dos rótulos do eixo Y
              font: {
                size: 16 // Tamanho da fonte das labels no eixo X
              }
            }
          }
        },
        plugins: {
          legend: {
            display: false // Remove a legenda
          }
        },
        elements: {
          line: {
            tension: 0.4 // Deixa as linhas mais suaves
          }
        }
      }
    });

    graficoRedeInstance = new Chart(graficoREDE, {
      type: 'line',
      data: {
        labels: dadosRede.labels,
        datasets: [{
          label: dadosRede.datasets[0].label,
          data: dadosRede.datasets[0].data,
          borderColor: 'white',
          backgroundColor: 'rgba(255, 255, 255, 0.5)',
          fill: true,
          pointBackgroundColor: 'white',
          pointBorderColor: 'white',
          pointRadius: 5,
          tension: 0.1
        }]
      },
      options: {
        scales: {
          x: {
            grid: {
              display: false // Remove a grade vertical
            },
            ticks: {
              color: 'white', // Cor dos rótulos do eixo X
              font: {
                size: 16 // Tamanho da fonte das labels no eixo X
              }
            }
          },
          y: {
            grid: {
              display: false // Remove a grade horizontal
            },
            ticks: {
              color: 'white', // Cor dos rótulos do eixo Y
              font: {
                size: 16 // Tamanho da fonte das labels no eixo X
              }
            }
          }
        },
        plugins: {
          legend: {
            display: false // Remove a legenda
          }
        },
        elements: {
          line: {
            tension: 0.4 // Deixa as linhas mais suaves
          }
        }
      }
    });



  }






  // gráficos estatico





  // Funções de card de alerta

  // esse é o id = descCardSucesso para innerHTML a mensagem de sucesso
  function abrirCardSucesoMensagem() {
    cardSucessoMsg
    const card = document.getElementById("cardSucessoMsg");
    card.classList.remove("fecharCardMensagem");
    card.classList.add("abriCardMensagem");
  }
  function fecharCardSucessoMensagem() {
    cardSucessoMsg
    const card = document.getElementById("cardSucessoMsg");
    card.classList.remove("abriCardMensagem");
    card.classList.add("fecharCardMensagem");
  }
  // esse é o id = descCardErro para innerHTML a mensagem de sucesso
  function fecharCardErroMensagem() {
    const card = document.getElementById("cardErroMsg");
    card.classList.remove("abriCardMensagem");
    card.classList.add("fecharCardMensagem");
  }
  function abrirCardErroMensagem() {
    const card = document.getElementById("cardErroMsg");
    card.classList.remove("fecharCardMensagem");
    card.classList.add("abriCardMensagem");
  }
  function usoCardMensagemErro() {
    abrirCardErroMensagem();
    setTimeout(() => {
      fecharCardErroMensagem();
    }, "7000");
  }
  function usoCardMensagemSucesso() {
    abrirCardSucesoMensagem();
    setTimeout(() => {
      fecharCardSucessoMensagem();
    }, "7000");
  }

</script>