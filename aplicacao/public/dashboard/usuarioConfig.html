<!DOCTYPE html>
<html lang="ptbr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOBANKING</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="shortcut icon" href="../imagens/logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/mensagemCard.css">
    <link rel="stylesheet" href="../css/usuarioConfig.css">
    <link rel="stylesheet" href="../css/default.css">
</head>

<body onload="exibirDados()">
    <div id="frame" class="frame-aplicacao" style="display: flex;">
        <nav class="menu-lateral" onmouseenter="exibirMenu()" onmouseleave="ocultarMenu()">
            <img src="../../imagens/mobank-logo-menu-lateral.svg" alt="Logo" class="logo-menu">

            <ul id="menuLateralBox">

                <li class="dashboard-item">
                    <a href="javascript:void(0);" onclick="toggleSubmenuServidores()">
                        <span class="icon-menu"><i class="fa-solid fa-server"></i></span>
                        <span class="titulo-link-menu">Servidores </span> <i
                            class="fa-solid setaMenuServidores fa-sort-down"></i>
                    </a>
                </li>

                <div class="submenuServidores" onmouseenter="manterSubmenu()" onmouseleave="fecharSubmenu()">
                    <li><a href="../dashboard/card.html">Máquinas</a></li>
                    <li><a href="../dashboard/dashboard-individual/maikon-dashboard.html">Status hardware</a></li>
                    <li><a href="../dashboard/dashboard-individual/joao-dashboard.html">Previsão de Alertas</a></li>
                </div>

                <li>
                    <a href="../dashboard/alertas.html" href="javascript:void(0);">
                        <span class="icon-menu"><i class="fa-solid fa-triangle-exclamation"></i></span>
                        <span class="titulo-link-menu">Alertas</span>
                    </a>
                </li>
                <li class="dashboard-item">
                    <a href="javascript:void(0);" onclick="toggleSubmenu()">
                        <span class="icon-menu"><i class="fa-solid fa-chart-pie"></i></span>
                        <span class="titulo-link-menu">Dashboard </span> <i class="fa-solid setaMenu fa-sort-down"></i>
                    </a>
                </li>
                <div class="submenu" onmouseenter="manterSubmenu()" onmouseleave="fecharSubmenu()">
                    <li><a href="../dashboard/dashboard-individual/fabio-dashboard.html">Picos de Horário</a></li>
                    <li><a href="../dashboard/dashboard-individual/kaua-dashboard.html">Picos de uso de CPU</a></li>
                    <li><a href="../dashboard/dashboard-individual/faria-dashboard.html">Panorama anual</a></li>
                    <li><a href="../dashboard/dashboard.html">Média de uso</a></li>
                </div>
            </ul>

            <div class="name-menu">
                <a href="../dashboard/usuarioInfo.html">
                    <h2 id="nome_perfil_menu"></h2>
                </a>
            </div>

            <a class="buttonSair-menu" href="../index.html">
                <h2>Sair</h2>
            </a>
        </nav>
        <div class="conteudo">

            <h1>Usuário</h1>

            <span class="title-dados-user">Dados do usuário</span>
            <span class="linha-title-dados"></span>

            <div class="form-box">
                <form action="">
                    <label for="email">
                        E-mail
                        <input id="email" value="maikon@gmail.com" type="email">
                    </label>
                    <label for="nome">
                        Nome
                        <input id="nome" value="Maikon Douglas Da Silva" type="text">
                    </label>
                    <label for="telefone">
                        Nova Senha
                        <input id="senha" value="" type="password">
                    </label>
                    <label for="senha">
                        Confirmar senha
                        <input id="confirmarSenha" value="" type="password">
                    </label>


                </form>
                <button onclick="confirmar()">Editar</button>
            </div>
        </div>
    </div>

    <div class="confirmarModal" id="confirmarModal">
        <h2>Deseja realmente editar seus dados ?</h2>
        <div>
            <button onclick="fechar(), editarUsuario()" class="simButon">Sim</button>
            <button onclick="fechar()" class="naoButon">Não</button>
        </div>
    </div>


    <!-- CARD DE SUCESSO -->

    <div id="cardSucessoMsg" class="cardMensagem fecharCardMensagem">
        <svg class="wave" viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z"
                fill-opacity="1"></path>
        </svg>

        <div class="icon-container">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke-width="0" fill="currentColor"
                stroke="currentColor" class="icon">
                <path
                    d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z">
                </path>
            </svg>
        </div>
        <div class="message-text-container">
            <p class="message-text">Mensagem de sucesso</p>
            <p class="sub-text" id="descCardSucesso"></p>
        </div>
        <svg onclick="fecharCardSucessoMensagem()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15"
            stroke-width="0" fill="none" stroke="currentColor" class="cross-icon">
            <path fill="currentColor"
                d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z"
                clip-rule="evenodd" fill-rule="evenodd"></path>
        </svg>
    </div>

    <!-- CARD DE ERRO -->
    <div id="cardErroMsg" class="cardMensagem fecharCardMensagem">
        <svg class="waveErro" viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L1428.6,320C1417.1,320,1394,320,1371,320C1348.6,320,1326,320,1303,320C1280,320,1257,320,1234,320C1211.4,320,1189,320,1166,320C1142.9,320,1120,320,1097,320C1074.3,320,1051,320,1029,320C1005.7,320,983,320,960,320C937.1,320,914,320,891,320C868.6,320,846,320,823,320C800,320,777,320,754,320C731.4,320,709,320,686,320C662.9,320,640,320,617,320C594.3,320,571,320,549,320C525.7,320,503,320,480,320C457.1,320,434,320,411,320C388.6,320,366,320,343,320C320,320,297,320,274,320C251.4,320,229,320,206,320C182.9,320,160,320,137,320C114.3,320,91,320,69,320C45.7,320,23,320,11,320L0,320Z"
                fill-opacity="1"></path>
        </svg>

        <div class="icon-containerErro">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" stroke-width="0" fill="currentColor"
                stroke="currentColor" class="iconErro">
                <path
                    d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z">
                </path>
            </svg>
        </div>
        <div class="message-text-container">
            <p class="message-textErro">Mensagem de erro</p>
            <p class="sub-text" id="descCardErro"></p>
        </div>
        <svg onclick="fecharCardErroMensagem()" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" stroke-width="0"
            fill="none" stroke="currentColor" class="cross-icon">
            <path fill="currentColor"
                d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z"
                clip-rule="evenodd" fill-rule="evenodd"></path>
        </svg>
    </div>

</body>

</html>

<script>

    
let submenuAberto = false;

function toggleSubmenu() {
    const submenu = document.querySelector('.submenu');
    const seta = document.querySelector('.setaMenu');

    submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
    submenuAberto = submenu.style.display === 'block';

    if (submenuAberto) {
      seta.classList.add("girarSeta");
    } else {
      seta.classList.remove("girarSeta");
    }
  }

  function toggleSubmenuServidores() {
    const submenu = document.querySelector('.submenuServidores');
    const setaServidores = document.querySelector('.setaMenuServidores');

    submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
    submenuAberto = submenu.style.display === 'block';

    if (submenuAberto) {
      setaServidores.classList.add("girarSetaServidores");
    } else {
      setaServidores.classList.remove("girarSetaServidores");
    }
  }

  function exibirMenu() {
    const menuLateral = document.querySelector('.menu-lateral');
    menuLateral.classList.add('menu-aberto');
  }

  function ocultarMenu() {
    const submenu = document.querySelector('.submenu');
    const submenuServidores = document.querySelector('.submenuServidores');
    const seta = document.querySelector('.setaMenu');
    const setaServidores = document.querySelector('.setaMenuServidores');

    // Fecha o submenu e redefine o ícone de seta quando o mouse sai do nav
    submenu.style.display = 'none';
    submenuServidores.style.display = 'none';
    seta.classList.remove("girarSeta");
    setaServidores.classList.remove("girarSetaServidores");
    submenuAberto = false;
    submenuServidoresAberto = false;
  }

    const menuLaterealHTML = document.getElementById('menuLateralBox')
    var sessTipoUsuario = sessionStorage.ID_TIPO_USUARIO
    if (sessTipoUsuario == 1) {
        menuLaterealHTML.innerHTML += `
     <li>
          <a href="funcionarios.html">
            <span class="icon-menu"><i class="fa-solid fa-user"></i></span>
            <span class="titulo-link-menu">Funcionários</span>
          </a>
        </li>
    `
    }

    nome_perfil_menu.innerHTML = sessionStorage.NOME_USUARIO

    function confirmar() {

        confirmarModal.style.top = '0'
        const frame = document.getElementById('frame');
        frame.classList.add('blur-grid')

    }

    function fechar() {

        const frame = document.getElementById('frame');
        frame.classList.remove('blur-grid')
        confirmarModal.style.top = '-20%'
    }

    function editarUsuario() {


        var emailVar = email.value
        var nomeVar = nome.value
        var senhaVar = senha.value

        var idUsuario = sessionStorage.ID_USUARIO

        if (email.value == "" || nome.value == "" || senha.value == "" || confirmarSenha.value == "") {
            alert("Preencha todos os campos!")
        } else if (senha.value != confirmarSenha.value) {
            alert("Senha Inválida")
        } else {
            fetch(`/usuarios/editarUsuario/${idUsuario}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    emailServer: emailVar,
                    nomeServer: nomeVar,
                    senhaServer: senhaVar
                }),
            }).then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {


                    usoCardMensagemSucesso()
                    descCardSucesso.innerHTML = `Refaça o login`


                    setTimeout(() => {
                        window.location = '../index.html'
                    }, "2000");


                } else {
                    console.log(resposta);
                    throw "Houve um erro ao tentar realizar a edição!";
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                return false;
            });
        }

    }

    function exibirDados() {

        var nomeUsuario = sessionStorage.NOME_USUARIO
        var emailUsuario = sessionStorage.EMAIL_USUARIO

        nome.value = nomeUsuario
        email.value = emailUsuario
    }

    // Funções de card de alerta

    // esse é o id = descCardSucesso para innerHTML a mensagem de sucesso
    function abrirCardSucesoMensagem() {

        const card = document.getElementById("cardSucessoMsg");
        card.classList.remove("fecharCardMensagem");
        card.classList.add("abriCardMensagem");
    }
    function fecharCardSucessoMensagem() {
        const card = document.getElementById("cardSucessoMsg");
        card.classList.remove("abriCardMensagem");
        card.classList.add("fecharCardMensagem");
    }
    // esse é o id = descCardErro para innerHTML a mensagem de sucesso
    function fecharCardErroMensagem() {
        const card = document.getElementById("cardErroMsg");
        card.classList.remove("abriCardMensagem");
        card.classList.add("fecharCardMensagem");
    }
    function abrirCardErroMensagem() {
        const card = document.getElementById("cardErroMsg");
        card.classList.remove("fecharCardMensagem");
        card.classList.add("abriCardMensagem");
    }
    function usoCardMensagemErro() {
        abrirCardErroMensagem();
        setTimeout(() => {
            fecharCardErroMensagem();
        }, "7000");
    }
    function usoCardMensagemSucesso() {
        abrirCardSucesoMensagem();
        setTimeout(() => {
            fecharCardSucessoMensagem();
        }, "7000");
    }


</script>